<!DOCTYPE html>
<html><head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Настройка</title>
	<link rel="stylesheet" href="../style.css">
	<script src="/scripts.js"></script>
	<script src="/site.js"></script>
</head><body>
~inc:menumain.inc~
	<div class="content">
		<h2 class="title">Настройка</h2>
		<form method="post" action="" onsubmit="SubmitFunction()">
			<table class="form">
				<tr>
					<td class="label">Период опроса счетчика:</td>
					<td><input name='cfg_glo_req_period' maxlength='10' value='~cfg_glo_req_period~'> сек</td>
				</tr>
				<tr>
					<td class="label">Период обновления страницы:</td>
					<td><input name='cfg_glo_refresh_t' maxlength='10' value='~cfg_glo_refresh_t~'> мсек</td>
				</tr>
				<tr>
					<td class="label">Макс. расхождение времени:</td>
					<td><input name='cfg_glo_time_maxmism' maxlength='10' value='~cfg_glo_time_maxmism~'> сек</td>
				</tr>
				<tr>
					<td class="label">Таймаут доступа:</td>
					<td><input name='cfg_glo_pwmt_rtout' maxlength='10' value='~cfg_glo_pwmt_rtout~'> мксек</td>
				</tr>
				<tr>
					<td class="label">Макс. время ответа:</td>
					<td><input name='cfg_glo_pwmt_tout' maxlength='10' value='~cfg_glo_pwmt_tout~'> мксек</td>
				</tr>
				<tr>
					<td class="label">Задержка после ошибки:</td>
					<td><input name='cfg_glo_pwmt_derr' maxlength='10' value='~cfg_glo_pwmt_derr~'> мксек</td>
				</tr>
				<tr>
					<td class="label">Кол-во повторов после ошибки:</td>
					<td><input name='cfg_glo_pwmt_cerr' maxlength='10' value='~cfg_glo_pwmt_cerr~'></td>
				</tr>
				<tr>
					<td class="label">Пауза после неустранимой ошибки:</td>
					<td><input name='cfg_glo_sleep_err' maxlength='10' value='~cfg_glo_sleep_err~'> сек</td>
				</tr>
				<tr>
					<td class="label">Кол-во повторяющихся ошибок для отключения питания (GPIO0+GPIO2=0):</td>
					<td><input title='используется внешний мк для сброса питания (WatchdogESP01), 255 - выкл.' name='cfg_glo_pwmt_rbt' maxlength='10' value='~cfg_glo_pwmt_rbt~'></td>
				</tr>
				<tr>
					<td class="label">Тариф Т1 (день), c:</td>
					<td><input title='hhmm (included)' name='cfg_glo_T1St' maxlength='4' value='~cfg_glo_T1St~'></td>
				</tr>
				<tr>
					<td class="label">Тариф Т1 (день), до:</td>
					<td><input title='hhmm' name='cfg_glo_T1En' maxlength='4' value='~cfg_glo_T1En~'></td>
				</tr>
				<tr>
					<td class="label">Стоимость тарифа Т1 (день):</td>
					<td><input title='nnn.nn' name='cfg_glo_tarif1' maxlength='6' value='~cfg_glo_tarif1~'> руб.</td>
				</tr>
				<tr>
					<td class="label">Стоимость тарифа Т2 (ночь):</td>
					<td><input title='nnn.nn' name='cfg_glo_tarif2' maxlength='6' value='~cfg_glo_tarif2~'> руб.</td>
				</tr>
				<tr>
					<td class="label">Время SNTP каждые:</td>
					<td><input title='если 0, то только при включении' name='cfg_glo_sntp_upd' maxlength='6' value='~cfg_glo_sntp_upd~'> минут</td>
				</tr>
				<tr>
					<td class="label">SNTP сервер:</td>
					<td><input name='cfg_glo_sntps' maxlength='20' value='~cfg_glo_sntps~'></td>
				</tr>
				<tr>
					<td class="label">Подстройка времени SNTP:</td>
					<td><input title='sec' name='cfg_glo_TAdj' maxlength='6' value='~cfg_glo_TAdj~'> сек</td>
				</tr>
				<tr>
					<td class="label">Сетевой адрес счетчика:</td>
					<td><input title='0 - any (write impossible)' name='cfg_glo_pwmt_addr' maxlength='4' value='~cfg_glo_pwmt_addr~'></td>
				</tr>
				<tr>
					<td class="label">Пароль пользователя (числа):</td>
					<td><input title='x,x,x,x,x,x' name='cfg_glo_pass1' maxlength='30' size='50' value='~cfg_glo_pass1~'></td>
				</tr>
				<tr>
					<td class="label">Пароль админа (числа):</td>
					<td><input title='x,x,x,x,x,x' name='cfg_glo_pass2' maxlength='30' size='50' value='~cfg_glo_pass2~'></td>
				</tr>
				<tr>
					<td class="label">Разд. полей csv (граф.):</td>
					<td><input title='char' name='cfg_glo_csv_delim' maxlength='1' value='~cfg_glo_csv_delim~'></td>
				</tr>
				<tr>
					<td class="label">Разд. десят. csv (граф.):</td>
					<td><input title='char' name='cfg_glo_csv_delimd' maxlength='1' value='~cfg_glo_csv_delimd~'></td>
				</tr>
				<tr>
					<td class="label">Разд. полей csv (итого):</td>
					<td><input title='char' name='cfg_glo_csv_delim_t' maxlength='1' value='~cfg_glo_csv_delim_t~'></td>
				</tr>
				<tr>
					<td class="label">Разд. десят. csv (итого):</td>
					<td><input title='char' name='cfg_glo_csv_delim_td' maxlength='1' value='~cfg_glo_csv_delim_td~'></td>
				</tr>
				<tr>
					<td class="label">Включить передачу IoT:</td>
					<td><input type='checkbox' name='cfg_iot_cloud_enable' value='~cfg_iot_cloud_enable~'></td>
				</tr>
				<tr>
					<td class="label">Настройка IoT:
					<input title='change?' type='checkbox' name='chg_iot_ini' value='0'></td>
					<td><textarea title='protect/iot_cloud.ini' name='cfg_iot_ini' rows=4 cols=50 wrap="off" maxlength=1023>~cfg_iot_ini~</textarea></td>
				</tr>
				<tr>
					<td class="label">Размер FRAM, байт:</td>
					<td><input title='1024..' name='cfg_glo_Fram_Size' maxlength='10' value='~cfg_glo_Fram_Size~'></td>
				</tr>
				<tr>
					<td class="label">Начальный адрес в FRAM:</td>
					<td><input title='0..' name='cfg_glo_Fram_Pos' maxlength='10' value='~cfg_glo_Fram_Pos~'></td>
				</tr>
				<tr>
					<td class="label">Частота доступа к FRAM:</td>
					<td><input title='100..400' name='cfg_glo_FramFr' maxlength='5' value='~cfg_glo_FramFr~'> кГц</td>
				</tr>
				<tr>
					<td class="label">Очистка данных:</td>
					<td><input type='password' title="Enter RESETn, n: ''-all, 1-eeprom, 2-Day array, 4-Minute array" name='cfg_glo_reset_data' maxlength='10' value=''></td>
				</tr>
				<tr>
					<td class="label">Счетчик, квт*ч * ~cfg_glo_PulsesPerKWt~:
					<input title='change?' type='checkbox' name='chg_tcnt' value='0'> 
					</td>
					<td><input title='0..4294967295' id='TCnt' name='cfg_glo_TotalCnt' maxlength='10' value='~TotalCnt~'>&ensp;&larr;&ensp;<input title='0.000..999999.999' id='kWt' size='8' value='0' onchange='CalcTotalCnt("TCnt","kWt")'>&nbsp;кВт*ч</td>
				</tr>
 			</table>
			<p class="center">
				<input type='hidden' name='cfg_glo_save' value='1'>
				<input type='submit' value='Set Config' class="button">
			</p>
		</form>
	</div>
	<div class="content">
		<p class="center">
			<a href="settings.bin">Скачать настройки.</a><br>
			<form method='post' action='/fsupload' enctype='multipart/form-data' class="center">
			Восстановить настройки:
			<input type='file' name='settings'> <input type='submit' value='Upload' class="button">
		<br><br>
			<a href="/protect/fram_all.bin">Скачать всю FRAM (~cfg_glo_Fram_Size~ байт).</a><br><br>
			<form method='post' action='/fsupload' enctype='multipart/form-data' class="center">
			Загрузить в FRAM:
			<input type='file' name='eeprom'> <input type='submit' value='Upload' class="button">
			</form>
		</p>
        <br>
	</div>
~inc:footer.inc~
<script type="text/javascript">
setFormCheckBoxes(document.forms[0]);
function SubmitFunction() {
	var inputs = document.forms[0].getElementsByTagName('input');
	for(var i=0; i<inputs.length; i++){
		var f = inputs[i];
		if(f.getAttribute('type') == 'checkbox'){
			if(f.checked) {
				f.value = '1';
			} else {
				if(f.name == 'chg_iot_ini') document.getElementsByName('cfg_iot_ini')[0].removeAttribute('name');
				else if(f.name == 'chg_tcnt') document.getElementsByName('cfg_glo_TotalCnt')[0].removeAttribute('name');
				else {
					f.checked = true;
					f.value = '0';
				}
			}
		}
	}
}
function CalcTotalCnt(cnt, kwt) {
	document.getElementById(cnt).value = Math.round(document.getElementById(kwt).value * ~cfg_glo_PulsesPerKWt~);
}
document.getElementById('kWt').value = (~TotalCnt~ / ~cfg_glo_PulsesPerKWt~).toFixed(3);
</script>
</body></html>